# ğŸ”§ ä»£ç è´¨é‡æŒ‡å—

## æ¦‚è¿°

æœ¬é¡¹ç›®ä½¿ç”¨ **Ruff** ä½œä¸ºä¸»è¦çš„ä»£ç æ£€æŸ¥å’Œæ ¼å¼åŒ–å·¥å…·ï¼Œä»¥ç¡®ä¿ä»£ç è´¨é‡å’Œä¸€è‡´æ€§ã€‚Ruff æ˜¯ä¸€ä¸ªæå¿«çš„ Python linter å’Œä»£ç æ ¼å¼åŒ–å·¥å…·ï¼Œå¯ä»¥æ›¿ä»£ flake8ã€blackã€isort ç­‰å¤šä¸ªå·¥å…·ã€‚

## ğŸ› ï¸ å·¥å…·é…ç½®

### Ruff é…ç½®

é¡¹ç›®åœ¨ `pyproject.toml` ä¸­é…ç½®äº† Ruffï¼ŒåŒ…æ‹¬ï¼š

- **ä»£ç æ£€æŸ¥è§„åˆ™**: å¯ç”¨äº†å¤šç§æ£€æŸ¥è§„åˆ™ï¼ŒåŒ…æ‹¬ Pyflakesã€pycodestyleã€isortã€pep8-naming ç­‰
- **ä»£ç æ ¼å¼åŒ–**: ä½¿ç”¨ç±»ä¼¼ Black çš„æ ¼å¼åŒ–é£æ ¼
- **å¯¼å…¥æ’åº**: è‡ªåŠ¨æ’åºå’Œç»„ç»‡å¯¼å…¥è¯­å¥
- **è‡ªåŠ¨ä¿®å¤**: æ”¯æŒè‡ªåŠ¨ä¿®å¤å¤§éƒ¨åˆ†ä»£ç é—®é¢˜

### å…¶ä»–å·¥å…·

- **MyPy**: é™æ€ç±»å‹æ£€æŸ¥
- **Bandit**: å®‰å…¨æ¼æ´æ£€æŸ¥
- **pre-commit**: Git æäº¤å‰è‡ªåŠ¨æ£€æŸ¥

## ğŸ“‹ ä»£ç è§„èŒƒ

### åŸºæœ¬è§„èŒƒ

1. **è¡Œé•¿åº¦**: æœ€å¤§ 88 å­—ç¬¦
2. **ç¼©è¿›**: ä½¿ç”¨ 4 ä¸ªç©ºæ ¼
3. **å¼•å·**: ä¼˜å…ˆä½¿ç”¨åŒå¼•å·
4. **å¯¼å…¥**: æŒ‰ç…§ isort è§„åˆ™æ’åº
5. **ç±»å‹æ³¨è§£**: ä½¿ç”¨ç°ä»£ Python ç±»å‹æ³¨è§£è¯­æ³• (`str | None` è€Œä¸æ˜¯ `Optional[str]`)

### å‘½åè§„èŒƒ

- **å˜é‡å’Œå‡½æ•°**: `snake_case`
- **ç±»å**: `PascalCase`
- **å¸¸é‡**: `UPPER_SNAKE_CASE`
- **ç§æœ‰æˆå‘˜**: ä»¥å•ä¸‹åˆ’çº¿å¼€å¤´ `_private`
- **ç‰¹æ®Šæ–¹æ³•**: åŒä¸‹åˆ’çº¿åŒ…å›´ `__special__`

### æ–‡æ¡£å­—ç¬¦ä¸²

```python
def example_function(param1: str, param2: int) -> bool:
    """
    ç®€çŸ­çš„å‡½æ•°æè¿°ã€‚
    
    Args:
        param1: å‚æ•°1çš„æè¿°
        param2: å‚æ•°2çš„æè¿°
        
    Returns:
        è¿”å›å€¼çš„æè¿°
        
    Raises:
        ValueError: å¼‚å¸¸æƒ…å†µçš„æè¿°
    """
    pass
```

## ğŸš€ ä½¿ç”¨æ–¹æ³•

### å‘½ä»¤è¡Œå·¥å…·

```bash
# å®‰è£…å¼€å‘ä¾èµ–
make dev-install

# è¿è¡Œä»£ç æ£€æŸ¥
make lint

# è‡ªåŠ¨ä¿®å¤ä»£ç é—®é¢˜
make lint-fix

# æ ¼å¼åŒ–ä»£ç 
make format

# è¿è¡Œæ‰€æœ‰æ£€æŸ¥
make check

# ç±»å‹æ£€æŸ¥
make type-check

# å®‰å…¨æ£€æŸ¥
make security
```

### VS Code é›†æˆ

é¡¹ç›®å·²é…ç½® VS Code è®¾ç½®æ–‡ä»¶ï¼Œå®‰è£…æ¨èæ‰©å±•åå¯ä»¥ï¼š

1. **ä¿å­˜æ—¶è‡ªåŠ¨æ ¼å¼åŒ–**: æ–‡ä»¶ä¿å­˜æ—¶è‡ªåŠ¨è¿è¡Œ Ruff æ ¼å¼åŒ–
2. **å®æ—¶é”™è¯¯æç¤º**: ç¼–è¾‘æ—¶æ˜¾ç¤º Ruff æ£€æŸ¥ç»“æœ
3. **è‡ªåŠ¨ä¿®å¤**: ä½¿ç”¨å¿«æ·é”®æˆ–å³é”®èœå•è‡ªåŠ¨ä¿®å¤é—®é¢˜
4. **å¯¼å…¥æ’åº**: è‡ªåŠ¨æ’åºå’Œç»„ç»‡å¯¼å…¥è¯­å¥

### Pre-commit Hooks

```bash
# å®‰è£… pre-commit hooks
make pre-commit-install

# æ‰‹åŠ¨è¿è¡Œæ‰€æœ‰ hooks
make pre-commit
```

## ğŸ“Š æ£€æŸ¥è§„åˆ™

### å¯ç”¨çš„è§„åˆ™ç±»åˆ«

- **E4, E7, E9**: pycodestyle é”™è¯¯
- **F**: Pyflakes é”™è¯¯
- **W**: pycodestyle è­¦å‘Š
- **I**: isort å¯¼å…¥æ’åº
- **N**: pep8-naming å‘½åè§„èŒƒ
- **UP**: pyupgrade ç°ä»£åŒ–è¯­æ³•
- **B**: flake8-bugbear å¸¸è§é”™è¯¯
- **A**: flake8-builtins å†…ç½®å‡½æ•°å†²çª
- **C4**: flake8-comprehensions åˆ—è¡¨æ¨å¯¼å¼
- **DTZ**: flake8-datetimez æ—¶åŒºå¤„ç†
- **T20**: flake8-print æ‰“å°è¯­å¥
- **SIM**: flake8-simplify ä»£ç ç®€åŒ–
- **ARG**: flake8-unused-arguments æœªä½¿ç”¨å‚æ•°
- **PTH**: flake8-use-pathlib è·¯å¾„å¤„ç†
- **ERA**: eradicate æ³¨é‡Šä»£ç 
- **PL**: Pylint è§„åˆ™
- **TRY**: tryceratops å¼‚å¸¸å¤„ç†
- **RUF**: Ruff ç‰¹å®šè§„åˆ™

### å¿½ç•¥çš„è§„åˆ™

- **E501**: è¡Œé•¿åº¦ï¼ˆç”±æ ¼å¼åŒ–å·¥å…·å¤„ç†ï¼‰
- **B008**: å‡½æ•°å‚æ•°é»˜è®¤å€¼
- **C901**: å¤æ‚åº¦æ£€æŸ¥
- **PLR0913**: å‚æ•°è¿‡å¤š
- **PLR0915**: è¯­å¥è¿‡å¤š
- **PLR2004**: é­”æ³•æ•°å­—
- **TRY003**: å¼‚å¸¸æ¶ˆæ¯é•¿åº¦
- **ARG001/ARG002**: æœªä½¿ç”¨å‚æ•°

## ğŸ” å¸¸è§é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆ

### 1. æ—¶åŒºç›¸å…³è­¦å‘Š (DTZ003)

**é—®é¢˜**: ä½¿ç”¨ `datetime.utcnow()` ä¼šè§¦å‘è­¦å‘Š

**è§£å†³æ–¹æ¡ˆ**: ä½¿ç”¨å¸¦æ—¶åŒºçš„ datetime
```python
# ä¸æ¨è
from datetime import datetime
now = datetime.utcnow()

# æ¨è
from datetime import datetime, timezone
now = datetime.now(timezone.utc)
```

### 2. å¼‚å¸¸å¤„ç† (B904)

**é—®é¢˜**: åœ¨ except å—ä¸­æŠ›å‡ºå¼‚å¸¸æ—¶ç¼ºå°‘ from å­å¥

**è§£å†³æ–¹æ¡ˆ**: ä½¿ç”¨ `raise ... from err` æˆ– `raise ... from None`
```python
# ä¸æ¨è
try:
    risky_operation()
except ValueError:
    raise CustomError("Something went wrong")

# æ¨è
try:
    risky_operation()
except ValueError as e:
    raise CustomError("Something went wrong") from e
```

### 3. å…¨å±€å˜é‡ (PLW0603)

**é—®é¢˜**: ä½¿ç”¨ global è¯­å¥æ›´æ–°å˜é‡

**è§£å†³æ–¹æ¡ˆ**: è€ƒè™‘ä½¿ç”¨ç±»æˆ–æ¨¡å—çº§åˆ«çš„çŠ¶æ€ç®¡ç†
```python
# ä¸æ¨è
redis_client = None

def init_redis():
    global redis_client
    redis_client = Redis()

# æ¨è
class RedisManager:
    def __init__(self):
        self.client = None
    
    def init(self):
        self.client = Redis()
```

### 4. æ‰“å°è¯­å¥ (T201)

**é—®é¢˜**: åœ¨ç”Ÿäº§ä»£ç ä¸­ä½¿ç”¨ print è¯­å¥

**è§£å†³æ–¹æ¡ˆ**: ä½¿ç”¨ logging æ¨¡å—
```python
# ä¸æ¨è
print("Debug message")

# æ¨è
import logging
logger = logging.getLogger(__name__)
logger.info("Debug message")
```

## ğŸ“ˆ CI/CD é›†æˆ

é¡¹ç›®é…ç½®äº† GitHub Actions å·¥ä½œæµï¼Œåœ¨æ¯æ¬¡æäº¤å’Œ PR æ—¶è‡ªåŠ¨è¿è¡Œï¼š

1. **Ruff æ£€æŸ¥**: ä»£ç é£æ ¼å’Œé”™è¯¯æ£€æŸ¥
2. **Ruff æ ¼å¼åŒ–æ£€æŸ¥**: ç¡®ä¿ä»£ç å·²æ­£ç¡®æ ¼å¼åŒ–
3. **MyPy ç±»å‹æ£€æŸ¥**: é™æ€ç±»å‹éªŒè¯
4. **Bandit å®‰å…¨æ£€æŸ¥**: å®‰å…¨æ¼æ´æ‰«æ
5. **æµ‹è¯•è¦†ç›–ç‡**: å•å…ƒæµ‹è¯•å’Œè¦†ç›–ç‡æŠ¥å‘Š

## ğŸ¯ æœ€ä½³å®è·µ

### 1. å¼€å‘æµç¨‹

1. ç¼–å†™ä»£ç æ—¶éµå¾ªé¡¹ç›®è§„èŒƒ
2. ä½¿ç”¨ VS Code æ‰©å±•å®æ—¶æ£€æŸ¥
3. æäº¤å‰è¿è¡Œ `make check` ç¡®ä¿é€šè¿‡æ‰€æœ‰æ£€æŸ¥
4. ä½¿ç”¨ pre-commit hooks è‡ªåŠ¨åŒ–æ£€æŸ¥

### 2. ä»£ç å®¡æŸ¥

1. ç¡®ä¿æ‰€æœ‰ Ruff æ£€æŸ¥é€šè¿‡
2. æ£€æŸ¥ç±»å‹æ³¨è§£çš„æ­£ç¡®æ€§
3. éªŒè¯æ–‡æ¡£å­—ç¬¦ä¸²çš„å®Œæ•´æ€§
4. ç¡®ä¿æµ‹è¯•è¦†ç›–ç‡è¾¾æ ‡

### 3. æŒç»­æ”¹è¿›

1. å®šæœŸæ›´æ–° Ruff ç‰ˆæœ¬
2. æ ¹æ®é¡¹ç›®éœ€è¦è°ƒæ•´è§„åˆ™é…ç½®
3. å…³æ³¨æ–°çš„ä»£ç è´¨é‡å·¥å…·å’Œæœ€ä½³å®è·µ
4. å›¢é˜Ÿå†…åˆ†äº«ä»£ç è´¨é‡ç»éªŒ

## ğŸ“š å‚è€ƒèµ„æº

- [Ruff å®˜æ–¹æ–‡æ¡£](https://docs.astral.sh/ruff/)
- [Python ä»£ç é£æ ¼æŒ‡å— (PEP 8)](https://peps.python.org/pep-0008/)
- [Python ç±»å‹æç¤º (PEP 484)](https://peps.python.org/pep-0484/)
- [Google Python é£æ ¼æŒ‡å—](https://google.github.io/styleguide/pyguide.html)

---

é€šè¿‡éµå¾ªè¿™äº›ä»£ç è´¨é‡æ ‡å‡†ï¼Œæˆ‘ä»¬å¯ä»¥ç¡®ä¿é¡¹ç›®ä»£ç çš„ä¸€è‡´æ€§ã€å¯è¯»æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚ 
